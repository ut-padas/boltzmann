\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{color}
\input{premble.tex}
\newcommand{\myint}[2]{\int\limits_{#1}^{#2}}
\newcommand{\diff}[1]{\, d#1}
\newcommand{\vect}[1]{\mathbf{#1}}
\usepackage{mleftright}
\newcommand{\of}[1]{\mleft( #1 \mright)}
\newcommand{\ddt}[1]{\partial_t #1}
\newcommand{\vth}{v_\textrm{th}}
\newcommand{\reals}{\mathbb{R}}

\title{Scalable deterministic numerical methods for the Boltzmann equation}
%\author{Milinda Fernando}
%\date{February 2014}

\begin{document}

%\begin{titlepage}
\maketitle
%\end{titlepage}

\section{Boltzmann Equation summary}
The Boltzmann equation is a nonlinear integro-differential equation that describes the evolution of the particle density function $f : \R^3 \times \R^3 \times \R \rightarrow \R^{+}_0$. Independent variables for the above density function denotes, time ($t$), position vector ($x$), and the velocity ($v$). For a fixed time $t$, $f(x,v,t)dx dv$ represent the number of particles for the phase space volume element $dxdv$. 

We can write the Boltzmann equation in the absence of external force field can be written as below. 
\begin{equation}
    \partial_t f + v\cdot \nabla_x f = \frac{1}{\epsilon}Q(f,f) \text{ for } x,v \in \R^3 \label{eq:be}
\end{equation}
In the presence of external force field (e.g., electromagnetic field) $L(x,t) : \R^3 \times \R \rightarrow \R$, the full Boltzmann equations can be written as, 
\begin{equation}
    \partial_t f + v\cdot \nabla_x f  + L \cdot \nabla_v f = \frac{1}{\epsilon}Q(f,f) \text{ for } x,v \in \R^3 \label{eq:be_full}
\end{equation}

The $\epsilon$ is known as the Knudsen number (dimensionless number, $\epsilon > 0$), $Q$ is the collision operator. 

\textbf{Note}: Unless stated otherwise, $v^\prime,v_*^\prime$ denotes the post-collision velocities and $v,v_*$ denotes the pre-collision velocities of a binary collision.

The collision operator (i.e., capture the physics of the collisions) can be broken up to two main parts, 
\begin{enumerate}
    \item Gain term ($C^+(f,f)$) : For a fixed $(t,x)$ how many particles created with velocity $v$.
    \item Loss term ($C^-(f,f)$) : For a fixed $(t,x)$ how many particles are lost with velocity $v$.
\end{enumerate} which are defined as follows. 

\begin{align}
    C^{+}(f,f) &= \int_{\R^3}\int_{S^2} B(|v-v_*|,\omega) f(v^\prime)f(v_*^\prime) d\omega dv_* \\
    C^{-}(f,f) &= \int_{\R^3}\int_{S^2} B(|v-v_*|,\omega) f(v)f(v_*) d\omega dv_* 
\end{align}

The collision operator then defined as, 
\begin{equation}
    \begin{split}
        C(f,f) = C^{+}(f,f) - C^{-}(f,f) %= \\ \int_{\R^3}\int_{S^2} B(|v-v_*|,\theta)(f(v^\prime)f(v_*^\prime) - f(v)f(v_*) ) d\omega dv_*    
    \end{split}
\end{equation}

\section{Electron - Ar collisions}
\label{sec:col_op_torch}

Assuming, that the neutral Ar atoms have $n_0\delta(0)$ distribution in the velocity space, where $n_0$ denotes the Ar density, and collision kernel $B$ approximation from experimental data, the above collusion operator simplifies to,
\begin{equation}
    C(f) = n_0 \int_{S^2} (f(v^\prime) - f(v)) \norm{v} \sigma(\norm{v},\omega) d\omega
\end{equation}

\subsection{Total and differential cross section}
For a given total cross section value, the differential cross section, can be computed as follows\cite{vahedi1995monte}, where $\varepsilon= \frac{1}{2}mv^2$
\begin{equation}
    \sigma(\varepsilon,\chi) = \frac{\sigma(\varepsilon)\varepsilon}{4\pi (1 + \varepsilon \sin^2(\chi/2))\ln(1+\varepsilon)} 
\end{equation}

\subsection{Post-collision velocity}
The scattering velocity direction is computed based on using following notations. Assumes vector coordinates w.r.t. basis $\hat{e_i},\hat{e_j}$ and $\hat{e_k}$.

\begin{itemize}
    \item $v_0$, $\hat{v_0}$ : pre-collision velocity, unit vector along $v_0$
    \item $v_1$, $\hat{v_1}$ : scattered (post-collision) velocity, unit vector along $\boldmath{v_1}$
    \item $\chi$ : scattering angle, i.e., the angle between vectors, $\hat{v_1}$ and  $\hat{v_0}$
    \item $\phi$ : angle between $v_1$ projection onto $v_0 \times(v_0 \times e_i)$, $v_0 \times e_i$ plane, and vector $v_0 \times(v_0 \times e_i)$
    \item $\theta$ : angle between $\hat{v_0}$ and $\hat{e_i}$, i.e., $cos\theta = \hat{v_0} \cdot \hat{e_i}$
\end{itemize}
The angle $\theta$ can be computed from $v_0$, and $\chi,\phi$ are taken to represent the solid angle for the collision event. The scattered velocity can be decomposed along the orthonormal basis vectors, $\hat{E_0}=\hat{v_{0}}$, $\hat{E_1}= \cfrac{\hat{v_0}\times e_i}{\sin\theta}$, and $\hat{E_2}= \hat{v_0}\times \hat{E_1}$. Therefore, the scattered direction unit vector can be written, 

\begin{equation}
    \hat{v_1} = \cos\chi \hat{v_0} + \sin\chi sin\phi (\frac{\hat{v_0}\times \hat{e_i}}{\sin\theta}) + \sin\chi cos\phi (\hat{v_0}\times \frac{\hat{v_0}\times \hat{e_i}}{\sin\theta}) \label{eq:scatter}
\end{equation}
We can see that, $\hat{v_1}\cdot \hat{v_1}=1$, and $\hat{v_1} \cdot \hat{v_0}= \cos\chi$.
When $\theta = 0 $, we can pick $\hat{E_0}=\hat{e_i}$, $\hat{E_1}=\hat{e_j}$ and $\hat{E_2}=\hat{e_k}$ as the basis to derive the scattering direction. 

In spherical coordinates, for a given incident vector $(v_r,\theta,\phi)$ that is not parallel to $\hat{e_i}$,  and scattering angle $(\chi,\gamma)$, we can compute the direction of the scattered particle as 

\begin{align}
    \theta^\prime &= \tiny \left\{\cos ^{-1}\left(\frac{\cos (\theta ) \left(\cos (\gamma ) \sin (\theta ) \sin (\chi ) \cos (\phi )+\cos (\chi ) \sqrt{1-\sin ^2(\theta ) \cos ^2(\phi )}\right)-\sin (\gamma ) \sin (\theta ) \sin (\chi ) \sin (\phi )}{\sqrt{1-\sin ^2(\theta ) \cos ^2(\phi )}}\right)\right\} \\
    \phi^\prime &= \tan ^{-1}\left(\frac{\sin (\chi ) \left(\cos (\gamma ) \sin ^2(\theta ) \sin (\phi ) \cos (\phi )+\sin (\gamma ) \cos (\theta )\right)+\sin (\theta ) \cos (\chi ) \sin (\phi ) \sqrt{1-\sin ^2(\theta ) \cos ^2(\phi )}}{\sin (\theta ) \cos (\chi ) \cos (\phi ) \sqrt{1-\sin ^2(\theta ) \cos ^2(\phi )}-\cos (\gamma ) \sin (\chi ) \left(\sin ^2(\theta ) \sin ^2(\phi )+\cos ^2(\theta )\right)}\right)
\end{align}

If the incident vector is parallel to the $\hat{e_i}$, we can compute the above, 
\begin{align}
    \theta^\prime &=\left\{\cos ^{-1}(\cos (\gamma ) \sin (\chi ))\right\} \\
    \phi^\prime &=\tan ^{-1}(\sin (\gamma ) \tan (\chi )) \\
\end{align}




\subsection{G0 : $e + Ar \rightarrow e + Ar$ collision operator}
\begin{equation}
    C_{G0}(f) = n_0 \int_{\chi} \int_{\phi} (f(v_1) - f(v_0)) \norm{v_0} \sigma_{G0}(\norm{v_0},\omega) \sin\chi d\phi d\chi
\end{equation}

Let $\varepsilon_0 = 1/2 m \norm{v_0}^2_2$ , $\varepsilon_1 = 1/2 m \norm{v_1}^2_2$, for inelastic collisions the energy lost, modeled based on \cite{vahedi1995monte}, (relative energy loss)
\begin{equation}
    \Delta \varepsilon = \frac{2m(1-cos\chi)}{M}
\end{equation} where, $m,M$ denotes the mass of the electron and the argon atom. Therefore the magnitude of the scattered velocity, can be written as, 
\begin{equation}
    \norm{v_1} = \norm{v_0} \sqrt{1- \frac{2m(1-cos\chi)}{M}}
\end{equation} where the direction of $v_1$ is specified by $\hat{v_1}$ in (\ref{eq:scatter}).

\subsection{G1 : $e + Ar \rightarrow e + Ar^*$ collision operator}
\begin{equation}
    C_{G1}(f) = n_0 \int_{\chi} \int_{\phi} (f(v_1) - f(v_0)) \norm{v_0} \sigma_{G1}(\norm{v_0},\omega) \sin\chi d\phi d\chi
\end{equation}
Let $\varepsilon_{exc}$ be the energy threshold to trigger an excitation reaction, then we can write, 
\begin{align}
    \frac{1}{2} m v_0 ^2  - \varepsilon_{exc} &= \frac{1}{2} m v_1 ^2 \\
    \norm{v_1} &= \sqrt{\norm{v_0}^2 - \frac{2\varepsilon_{exc}}{m}}
\end{align} where the direction of $v_1$ is specified by $\hat{v_1}$ in (\ref{eq:scatter}). Note that, we use excitation threshold of $\varepsilon_{exc}=11.5eV$.

\subsection{G2 : $e + Ar \rightarrow e + Ar^+ + e$ collision operator}
\begin{itemize}
    \item $v_1$ : velocity of the scattered electron
    \item $v_2$ : velocity of the ejected electron from Ar. 
\end{itemize}
\begin{equation}
    C_{G2}(f) = n_0 \int_{\chi} \int_{\phi} (f(v_1) + f(v_2) - f(v_0)) \norm{v_0} \sigma_{G2}(\norm{v_0},\omega) \sin\chi d\phi d\chi
\end{equation}

Let $\varepsilon_{ion}$ be the energy threshold for the ionization reaction, then as in \cite{vahedi1995monte} we split the $\varepsilon_0-\varepsilon_{ion}$ equally among scattered and the ejected electron. i.e., $\varepsilon_1 = 0.5 (\varepsilon_0-\varepsilon_{ion})$, $\varepsilon_2 = 0.5 (\varepsilon_0-\varepsilon_{ion})$. Therefore, we can derive the velocity magnitudes of the scattered and ejected electrons as follows. 
\begin{align}
    \norm{v_1} &= \sqrt{\frac{1}{2}\norm{v_0}^2 - \frac{\varepsilon_{ion}}{m}}\\
    \norm{v_2} &= \sqrt{\frac{1}{2}\norm{v_0}^2 - \frac{\varepsilon_{ion}}{m}}
\end{align}
The direction of $v_1$ is given by $\hat{v_1}$ as in (\ref{eq:scatter}) and the direction of the $v_2$ derived based on the momentum conservation, assuming the momentum change in the Ar atom is negligible. 
\begin{align}
    m v_0 + M v &= Mv + m v_1 + m v_2  \\
    \hat{v_2} &= \frac{v_0 - v_1}{\norm{v_0 - v_1}}
\end{align}



\section{Maxwell-Boltzmann distribution (Maxwellian)}
\label{sec:maxwellian}
A particularly important velocity distribution function is the Maxwell-Boltzmann distribution, or Maxwellian. It describes the spread of velocities for a gas which is in thermal equilibrium. Maxwellian in $d$ dimensional velocity space can be written as,

\begin{equation}
    M(v) = A \exp(-\frac{mv^2}{2k_BT})
\end{equation}
using the number density equation, we can derive the coefficient $A$ as follows, 
\begin{equation}
M(v) = \frac{n}{(\sqrt{\pi}v_{th})^d} \exp{(-(\frac{v}{v_{th}})^2)}    
\end{equation} where, $v_{th}$ defined as, 
\begin{equation}
    v_{th} = \sqrt{\frac{2kT}{m}}
\end{equation}



%\section{Splitting the Boltzmann}
%\label{sec:split}

\section{Collision Operator}
\label{sec:collision_operator}
The term $v\cdot \nabla_x f$ makes the distribution $f(v)$ at fixed $(t,x)$ coupled with $f(v)$ defined in neighboring $x$. In operator splitting methods, Boltzmann equation is split in to ``transport'' and ``collision'' part. First we are going to focus on the collision part, given by, 
\begin{equation}
    \partial_t f = \frac{1}{\epsilon}C(f,f) \label{eq:col_op}
\end{equation}
% Note that without the transport term, for fixed $(t,v)$, for $x\neq x_*$ $f(x)$ and $f(x_*)$ can be evolved independently decoupled way. \emph{This allows, spatially subdivision based parallelization algorithms for the Boltzmann equation.}

% \subsection{Properties of the collision operator}
% \label{subsec:collision_op_properties}
% For a given $\R^d$ velocity space,
% \begin{theorem}
%     The Boltzmann collision operator conserves few of it moments, namely, mass, momentum, and energy.
%     \begin{align}
%         \int_{\R^d} Q(f,f) dv  = 0 \\
%         \int_{\R^d} Q(f,f) v dv  = 0 \\
%         \int_{\R^d} Q(f,f) |v|^2dv  = 0 \\
%     \end{align}
% \end{theorem}

% The solution for (\ref{eq:col_op}) evolves towards steady state, defined as the Maxwellian, which is given by, 
% \begin{equation}
%     f_{\infty}(v) = \frac{\rho}{(2\pi T)^{d/2}} \exp{-\frac{|V-v|^2}{2T}}
% \end{equation} where, the Maxwellian depends on the quantities computed from the initial distribution. 

% \begin{itemize}
%     \item \textbf{Density} : $\rho = \int_{\R^d} f(v) dv$ 
%     \item \textbf{Mean/Bulk velocity}: $V=\frac{1}{\rho} \int_{\R^d} v f(v) dv$ 
%     \item \textbf{Temperature}: $T= \frac{1}{3\rho} \int_{\R^d} |V-v|^2 f(v) dv$
% \end{itemize}

\section{0D space collision operator for electron-neutral collisions}
\label{sec:electron_neutral_pc}
Let $f_e(v,t)$ be the electron density and $f_o(v,t)=\delta(v)$ for all $(t,x)$. Then the evolution of the $f_e$ can be written as, 
\begin{equation}
    \partial_t f_e(v,t) = C(f_e,f_0)
\end{equation}
Let $(v^\prime,v_*^\prime) \rightarrow (v,v_*)$ be the pre and post collision velocities. The assumption $f_o(v,t)=\delta(v)$, implies neutral particles are mostly centered at velocity $0$. We can write the pre collision velocities as, $v^\prime=v^\prime(v,\omega)$. 

With these assumptions, the generic collision operator, for fixed time $t$ can be simplified for follows. 
\begin{align}
    C(f_e,f_0) &= \int_{\R^3}\int_{S^2} B(|v-v_*|,\omega)(f_e(v^\prime)f_0(v_*^\prime) - f_e(v)f_0(v_*) ) d\omega dv_*
\end{align}
Change of the integral order (assumes that the integral is finite) with properties of the Dirac's delta function, we can write, 
\begin{align}
    C(f_e,f_0) &= \int_{S^2} B(|v|,\omega)(f_e(v^\prime) - f_e(v)) d\omega
\end{align}

Then we can write the final evolution equation as, 
\begin{equation}
    \partial_t f_e(v,t) = \int_{S^2} B(|v|,\omega)(f_e(v^\prime,t) - f_e(v,t)) d\omega
\end{equation}

Since we know the above evolution will reach the Maxwellian at $t\rightarrow \infty$, we approximate $f_e(v,t)$ as follows, where $M(v)$ denotes the Maxwellian, 
\begin{equation}
    f_e(v,t) = M(v)[1 + h(v,t)] \label{eq:maxwelian}
\end{equation}
The idea is that when $t\rightarrow \infty$ the time dependent, $h(v,t)\rightarrow 0$.
Assuming that $\phi(v)$ is our test function with required properties. We can write the variational form for the above as, 
\begin{equation}
    \frac{\partial}{\partial t} \int_{\R^3} f_e(v,t) \phi(v) dv = \int_{\R^3} \int_{S^2} B(|v|,\omega)(f_e(v^\prime,t) - f_e(v,t)) \phi(v) d\omega dv \label{eq:0d_wf}
\end{equation}

Let $P_i(v)$ be orthonormal polynomial basis with the weighted inner product in the velocity space, where $w(v)$ denotes tha weight function. 
\begin{align}
    \int_{V} w(v)P_i(v)P_j(v) dv &= k_i\delta_{ij}
\end{align}

Assuming finite dimensional expansion for fixed time $t$, on $f(v,t)$, we can write, 
\begin{equation}
    f(v,t) \approxeq \bar{f}(v,t) = M(v)\sum_{j=0}^{N_v} f_j(t) P_j(v) \label{eq:basis_expansion}
\end{equation}

% Substituting (\ref{eq:basis_expansion}) to (\ref{eq:0d_wf}) we can write, 
% \begin{align}
%     \partial_t \int_{\R^3} w(v)h(v,t)\phi(v) dv &=  \int_{\R^3} \int_{S^2} (M(v^\prime) - M(v)) \phi(v) B(|v|,\omega) d\omega dv\\
%     &+\int_{\R^3} \int_{S^2} (M(v^\prime)h(v^\prime,t) - M(v)h(v,t)) B(|v|,\omega) \phi(v) d\omega dv
% \end{align}
For the above, By substituting, basis expansion for $f(v,t)$ we can write, 
\begin{align}
    \partial_t \int_{\R^3} M(v)\sum_{j=0}^{N_v} f_j(t) P_j(v) \phi(v) dv &= \\\int_{\R^3} \int_{S^2} M(v^\prime)\sum_{j=0}^{N_v} f_j(t) P_j(v^\prime) & B(|v|,\omega) \phi(v) d\omega dv \nonumber \\
    -\int_{\R^3} \int_{S^2} M(v)\sum_{j=0}^{N_v} f_j(t) P_j(v) &B(|v|,\omega) \phi(v) d\omega dv
\end{align}
By choosing $\phi(v) = P_i(v)$, we can further simplify, 
\begin{align}
    \text{diag}(k_i^\prime)\partial_t{f_i} = \sum_{j=0}^{N_v} L_{ij} f_j(t)
\end{align} where, 
\begin{equation}
    L_{ij} = \int_{\R^3} \int_{S^2} (M(v^\prime) P_i(v)P_j(v^\prime)  - M(v) P_i(v) P_j(v) )  B(|v|,\omega) d\omega dv
\end{equation}
\begin{equation}
    k_{i}^\prime = \int_{\R^3} M(v) P_i(v)^2 dv
\end{equation}

\subsection{Hermite Polynomials}
Let $H_k (x)$ be the sequence of Hermite polynomials, defined on $(\infty,infty)$ and are orthogonal with respect to the weight function $w(x) = \exp(-x^2/2)$. More precisely we can write, 
\begin{equation}
    \int_{-\infty}^{\infty} w(x) H_i(x) H_j(x) dx = \sqrt{2\pi} n! \delta_{ij}
\end{equation}where the polynomials can be generated using, 
\begin{equation}
    H_k(x) = (-1)^k \exp(x^2/2) \frac{d^k}{dx^k} \exp(-x^2/2)
\end{equation}. The corresponding Gauss-Hermite quadrature can be defined as, 
\begin{equation}
    \int_{-\infty}^{\infty} w(x) f(x) \approx \sum_{q=1}^{n} w_i f(x_i)
\end{equation} where, $x_i$ are the roots of $H_n(x)$, and $w_i$ are the corresponding weights for the Gaussian quadrature. 


% \subsection{Discretization of the integrals}
% \label{subsec:discretization_integrals}
% To perform discretization of the integrals in the velocity space we need to assume a finite bounded domain for the velocity space. 

% \textbf{Note}: The integrand will decay exponentially with increasing values of $v$, due to the $M(v)$. Hence, assume velocity integral is evaluated on the bounded subspace $V\subset \R^3$.

% \textbf{Integral over $S^2$}: 
% \begin{align}
%     I(g) &= \int_{S^2} g(\omega) d\omega\\
%     I(g) &= \int_{0}^{2\pi} \int_{0}^{\pi} g(\theta,\phi) \sin\theta d\theta d\phi 
% \end{align}

% Let $M_s$ denotes the number of $\theta_i$ chosen such that, $cos\theta_i,w_i$ are the Gauss-Legendre nodes and weights on $[-1,1]$. $\phi_j = \frac{j\pi}{m}$  are evenly spaced in $[0,2\pi]$. Then the above quadrature accurate up to polynomials order of $2M_s-1$.

% \begin{equation}
%     I(g) = \frac{\pi}{m} \sum_{q=1}^{2M_s} \sum_{p=1}^{M_s} w_p g(\theta_p,\phi_q) \label{eq:sphere_quadrature}
% \end{equation}

% % \textbf{Integral over velocity space ($\R^3$)}: Note that, when $|v|\rightarrow \infty$, $M(v)\rightarrow 0$, hence the integrand decays exponentially. Let's choose, bounded domain $V$, such that $V\subset \R^3$, such that, integral $\int_{\R^3\setminus V} M(v) \square dv < \epsilon$, where $\epsilon >0$. 

% \textbf{Integral over velocity space ($\R^3$)}: Let $x_r,w_r$ be the quadrature points, and weights in $\R^3$. For each velocity quadrature point and selected polynomial $P_j$, we can write the spherical quadrature as follows.  
% \begin{align}
%     Q(v_r)^{j} = \frac{\pi}{m} \sum_{q=1}^{2M_s} \sum_{p=1}^{M_s} &w_p (M(v^\prime(V_r,\theta_p,\phi_q))P_j(v^\prime(V_r,\theta_p,\phi_q))  -\\& M(v_r) P_j(v_r) ) \sin\theta_p B(|v_r|,\theta_p,\phi_k) \nonumber
% \end{align}
% Each $L_{ij}$ matrix entry can be computed as,  
% \begin{equation}
%     L_{ij} = \sum_{r} w_r Q(v_r)^{j}/w(v_r)
% \end{equation}




% Using the cartesian product on 1D basis functions, let's construct the basis functions in 3D. If we have $(N_v +1)$ coefficients in 1D, then we will have $(N_v+1)^3$ coefficients in 3D. Weights and quadrature points can be constructed the similar way for the domain $V$.  

% Then the above integral can be approximated as, 
% \begin{equation}
%     L_{ij} = \sum_{r=1}^{(N_v+1)^3} w_r Q(v_r)
% \end{equation} where, 
% \begin{align}
%     Q(v_r) = \frac{\pi}{m} \sum_{q=1}^{2M_s} \sum_{p=1}^{M_s} &w_p (M(v^\prime(V_r,\theta_p,\phi_q)) P_i(v_r)P_j(v^\prime(V_r,\theta_p,\phi_q))  -\\& M(v_r) P_i(v_r) P_j(v_r) ) \sin\theta_p B(|v_r|,\theta_p,\phi_k) \nonumber
% \end{align}

%Therefore the cost of computing the $L$ matrix would be $\mathbb{O}()$




% \begin{definition}{Hermite polynomials}
    
% \end{definition}

% \section{Time discretization}
% \label{sec:time_discretization}

% \begin{itemize}
%     \item How to ensure non-negativity of $f_e$ ? 
%     \item Implicit or Explicit ? 
% \end{itemize}

\section{Maxwellian polynomials with spherical coordinates}

For the electron-Boltzmann equation, the generalized weak form of the collision operator can be written as follows (note: velocity should be normalized by the thermal velocity).
\begin{equation}
    L_{ij} = n_0 \int_{\R^3} \int_{S^2} (M(v^\prime) P_i(v)P_j(v^\prime)  - M(v) P_i(v) P_j(v) )  B(|v|,\omega) d\omega dv \label{eq:cOp}
\end{equation}

\begin{equation}
    M_{ij} = \int_{\R^3} M(v) P_i(v)P_j(v) dv
\end{equation}

In spherical coordinates, the above becomes, 

\begin{align*}
    {L}_{k,l,m}^{p,q,s} &=n_0
    \myint{0}{+\infty} 
    v^2
    P^p \of{\frac{v}{\vth}} 
    \myint{S^2}{}
    \myint{S^2}{}
    B\of{v,\omega} Y^{qs}\of{v_\theta, v_\phi} 
     \times
    \\
    & \times
    \left(
    M\of{v^\prime} P_k\of{\frac{v^\prime}{\vth}} Y_{lm}\of{v_\theta^\prime, v_\phi^\prime}
    -
    M\of{v} P_k\of{\frac{v}{\vth}} Y_{lm}\of{v_\theta, v_\phi}
    \right)
    \diff{\omega}
    \diff{v_\omega}
    \diff{v} 
\end{align*}

\begin{align*}
    {M}_{k,l,m}^{p,q,s} &=
    \myint{0}{+\infty} 
    v^2
    M\of{v} P^p \of{\frac{v}{\vth}}  P_k \of{\frac{v}{\vth}} \delta^{qs}_{lm}
    \diff{v} 
\end{align*}

\subsection{Tensorized computation of ${L}_{k,l,m}^{p,q,s}$}

\begin{align*}
    {L}_{k,l,m}^{p,q,s} &= {L^{+}}_{k,l,m}^{p,q,s} - {L^{-}}_{k,l,m}^{p,q,s}
\end{align*} where, 
\begin{align*}
    {L^{+}}_{k,l,m}^{p,q,s} = n_0 \int_{v_r} 
                               \int_{S^2(v_\theta,v_\phi)}
                               \int_{S^2(\chi,\gamma)} & 
                               v^2 M(v^\prime) P^p \of{\frac{v}{\vth}} Y^{qs}\of{v_\theta, v_\phi} \times \\ & P_k\of{\frac{v^\prime}{\vth}} Y_{lm}\of{v_\theta^\prime, v_\phi^\prime} |v|\sigma(|v|,\chi) d\omega d\omega_v dv \\
    {L^{-}}_{k,l,m}^{p,q,s} = n_0 \int_{v_r} 
                              \int_{S^2(v_\theta,v_\phi)}
                              \int_{S^2(\chi,\gamma)} & 
                              v^2 M(v) P^p \of{\frac{v}{\vth}} Y^{qs}\of{v_\theta, v_\phi} \times \\ & P_k\of{\frac{v}{\vth}} Y_{lm}\of{v_\theta, v_\phi} |v|\sigma(|v|,\chi) d\omega d\omega_v dv
\end{align*}

The list of tensors that can be precomputed
\begin{itemize}
    \item $V_r$ - quadrature points on the radial direction (incident velocities)
    \item $W_r$ - quadrature weights on the radial direction
    \item $V_\theta$ - quadrature points on the polar direction 
    \item $W_\theta$ - quadrature weights for theta
    \item $V_\phi$ - quadrature points on the azimuthal direction 
    \item $S_\chi$ - quadrature points on the scattering angle
    \item $S_\gamma$ - quadrature points on the azimuthal angle (for scattering direction)
    \item $W_\chi$ - quadrature weights
    \item $\sigma_{r\chi}$ - differential cross section tensor (rank 2)
    \item $Y_{lm}^{\theta\phi}$ - $lm$-mode spherical harmonic function evaluated at $(V_\theta, V_\phi)$. The sparse version (i.e., for given $l$ mode not selecting all the $m$ modes) , but generally can be considered as rank 4 tensor. 
    \item $M_r$ - Maxwellian times $v_r$ evaluated at $V_r$
    \item $P_{kr}$     - $k^{th}$ Maxwell polynomial evaluated at the $V_r$ $r^{th}$ location.
\end{itemize}
Notation : Same index up-down denotes contraction, $\otimes$ for kronecker product, same level index, same index (i.e., up-up, down down) denotes the element-wise multiplication. 
The total cross section $\sigma_r$, can be written as, 
\begin{align}
    \sigma_r &= \frac{\pi}{|S\chi|} \sigma_{r,\chi} W^\chi
\end{align}

The weighted spherical harmonic tensor, 
\begin{align}
    \tilde{Y}^{qsr}_{\theta\phi} = \mleft({Y}^{qs}_{\theta\phi} W_\theta \frac{\pi}{|V\chi|} \mright) 
\end{align}

Then we can write, 
\begin{align}
    {L^{-}}_{k,l,m}^{p,q,s} &= ((P^p_r W_r \sigma_r) (P^r_k M^r) ) \otimes Y_{lm}^{\theta\phi} \tilde{Y}^{qs}_{\theta\phi} \\
    {L^{-}}_{k,l,m}^{p,q,s} &= ((P^p_r W_r \sigma_r) (P^r_k M^r) ) \otimes \delta^{qs}\delta_{lm} %Y_{lm}^{\theta\phi} \tilde{Y}^{qs}_{\theta\phi} 
\end{align}


More additional tensors that we need to compute the $L^{+}$ component. 

\begin{itemize}
    \item $S^{r\theta\phi\chi\gamma}_{r^\prime\theta^\prime \phi^\prime}$ : Scattering velocity tensor, for each $v=(r,\theta,\phi)$ and scattering solid angle $(\chi,\gamma)$ computes $(r^\prime,\theta^\prime,\phi^\prime)$ scattered or newly created particle velocity (i.e., in G2 ejected electron). This is a rank 8 tensor where it might be too expensive to compute. For cases $G0$, $G1$ we can compute $S^{r\theta\phi\chi\gamma}_{r^\prime\theta^\prime \phi^\prime} = {S^r}_{r^\prime} \otimes S^{\theta\phi\chi\gamma}_{\theta^\prime \phi^\prime}$ since radial component only depends on energy, while for reactions like $G2$ it's depends on both energy and direction (i.e., for momentum conservation).
    \item $P^{r\theta\phi\chi\gamma}_{k}$ - radial polynomial evaluated at differed velocity for given incident particle ($r,\theta,\phi,\chi,\gamma$)
    \item $M^{r\theta\phi\chi\gamma}$ - Maxwellian times $v_r$ evaluated for the differed particle for a given incident particle ($r,\theta,\phi,\chi,\gamma$)
    \item $Y^{r\theta\phi\chi\gamma}_{lm}$ - $lm$ spherical harmonic mode evaluated differed particle direction for a given incident particle ($r,\theta,\phi,\chi,\gamma$)
    \item $\sigma^{r\theta\phi\chi\gamma}$ - differential cross section broadcasted on scattering cross section angles. 
    \item $B^{r\theta\phi}_{pqs}$ - $pqs$ basis evaluated at the incident grid.              
\end{itemize}

For the general case, of the differed particle, (i.e., differed particle all velocity components are functions of $r,\theta,\phi,\chi,\gamma$) we can write the following. Note, $A$ is obtained for contraction on the $\gamma$ azimuthal of angle of the scattered particle, $B$ is obtained with contraction on the polar angle of the scattering direction, $C$ is obtained contraction on $(\theta,\phi)$ for the velocity space angular directions, and finally $L^{+}$ obtained using radical direction contraction. 

\begin{align}
    A^{r\theta\phi}_{klm}   &=  ( P^{r\theta\phi\chi\gamma}_{k} M^{r\theta\phi\chi\gamma} Y^{r\theta\phi\chi\gamma}_{lm}) W{\gamma} W_{\chi} \\
    {L^{+}}_{k,l,m}^{p,q,s} &=  B^{r\theta\phi}_{pqs} A^{r\theta\phi}_{klm} W_\phi W_\theta W_r
    % B^{r\theta\phi}_{klm}      & = \frac{\pi}{|S_\gamma|} \sigma^{r\chi} (W_\chi A^{r\theta\phi}_{\chi klm}) \\
    % C^{rqs}_{klm}              & = \tilde{Y}^{qs}_{\theta\phi} B^{r\theta\phi}_{klm} \\
    %{L^{+}}_{k,l,m}^{p,q,s}     & = {P^p}_r C^{rqs}_{klm}
\end{align}

\subsection{Distribution moments in basis expansion}
Let $f(v) = M(v_\alpha) \sum_{klm} h_{klm} \phi_klm(v\alpha)$, where $v_\alpha = v/\alpha$. Then we can write the first moment of the distribution, 
\begin{align}
    n_e & = \int_{R^3} f(v) dv \\
\end{align} which can be written as, 
\begin{align}
    n_e & = Q h 
\end{align} where, taking $k=(p,q,s)$ 
\begin{align}
    Q_{klm} & = \int_{\R^3} M(v_\alpha) \phi_{klm}(v_\alpha) dv = 0  \text{ if } klm \neq 000 \\
    Q_{000} & = \int_{\R^3} M(v_\alpha) \phi_{klm}(v_\alpha) dv = \frac{n}{4\pi}
\end{align}



\subsection{Varying thermal velocity}
Let $\alpha,\beta$ be two thermal velocities, and their corresponding normalized velocity be $v_\alpha=v/\alpha,v_\beta=v/\beta$.
Let $f(v) = M(v_\alpha) h(v_\alpha)$. Let $h^{(\alpha)}$ be the basis coefficients w.r.t. the chosen basis. Let us try to expand $f(v)$ using maxwellian at different temperature say at $\beta$, let $h^{(\beta)}$ be the coefficients for the expansion.
\begin{equation}
    M^{(\beta)} h^{(\beta)} = W^{(\alpha)} h^{(\alpha)}
\end{equation} where, 
\begin{align}
    M^{(\beta)}_{ij} &= \int_{v} \int_{S^2} M(v_\beta) \phi_i(v_\beta) \phi_j(v_\beta) d\omega dv  = \frac{n}{4\pi} \delta_{ij} \\
    W^{(\alpha)}_{ij} &= \int_{v} \int_{S^2} M(v_\alpha) \phi_i(v_\beta) \phi_j(v_\alpha) d\omega dv   
\end{align}

For $W_ij^{(\alpha)}$, let i=0, then we can write (Note : $\phi_0(v_\beta)=1$)
\begin{align*}
    W^{(\alpha)}_{0j} &= \int_{v} \int_{S^2} M(v_\alpha) \phi_0(v_\beta) \phi_j(v_\alpha) d\omega dv\\
    W^{(\alpha)}_{0j} &= \int_{v} \int_{S^2} M(v_\alpha) \phi_j(v_\alpha) d\omega dv = \frac{n}{4\pi} \delta_{0j}
\end{align*}
Therefore, we can write $h^{(\beta)}_0=h^{(\alpha)}_0$. There zeroth coefficient always match hence we should preserve zeroth moment of the distribution. 

 


\bibliographystyle{plain}
\bibliography{bte_notes.bib}


\end{document}
